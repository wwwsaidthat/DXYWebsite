<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>文章列表 - 我的个人博客</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<header class="site-header">
<div class="container header-inner">
<div class="logo">我的博客</div>
<nav class="nav">
<a href="index.html" class="nav-link">首页</a>
<a href="posts.html" class="nav-link active">文章</a>
<a href="about.html" class="nav-link">关于</a>
</nav>
</div>
</header>
<main class="site-main">
  <section class="section">
    <div class="container">
      <div class="posts-header">
        <h1 class="section-title">文章列表</h1>
        <div class="category-filter" id="category-filter">
          <button class="filter-btn active" data-category="all">全部</button>
          <!-- 分类按钮将由 JS 动态生成 -->
        </div>
      </div>
      
      <div class="post-list" id="post-list">
        <!-- 文章列表将由 JS 动态生成 -->
        <div class="loading">正在加载文章...</div>
      </div>
    </div>
  </section>
</main>
<footer class="site-footer">
  <div class="container footer-inner">
    <span>© <span id="year"></span> 我的个人博客</span>
    <span>Powered by GitHub Pages</span>
  </div>
</footer>
<script>
  document.getElementById("year").textContent = new Date().getFullYear();

  // 加载文章数据
  fetch('posts/posts.json')
    .then(response => response.json())
    .then(posts => {
      renderCategories(posts);
      renderPosts(posts, 'all');
    })
    .catch(error => {
      console.error('Error loading posts:', error);
      document.getElementById('post-list').innerHTML = '<p class="error">加载文章列表失败，请稍后重试。</p>';
    });

  function renderCategories(posts) {
    const categories = new Map();
    posts.forEach(post => {
      if (post.category && post.categoryName) {
        categories.set(post.category, post.categoryName);
      }
    });

    const filterContainer = document.getElementById('category-filter');
    categories.forEach((name, key) => {
      const btn = document.createElement('button');
      btn.className = 'filter-btn';
      btn.dataset.category = key;
      btn.textContent = name;
      btn.onclick = () => {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderPosts(posts, key);
      };
      filterContainer.appendChild(btn);
    });
    
    // 绑定"全部"按钮事件
    const allBtn = filterContainer.querySelector('[data-category="all"]');
    allBtn.onclick = () => {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      allBtn.classList.add('active');
      renderPosts(posts, 'all');
    };
  }

  function renderPosts(posts, category) {
    const container = document.getElementById('post-list');
    container.innerHTML = '';

    const filteredPosts = category === 'all' 
      ? posts 
      : posts.filter(post => post.category === category);

    if (filteredPosts.length === 0) {
      container.innerHTML = '<p class="no-posts">该分类下暂无文章。</p>';
      return;
    }

    filteredPosts.forEach(post => {
      const article = document.createElement('article');
      article.className = 'post-item';
      
      const link = document.createElement('a');
      link.className = 'post-title-link';
      // 根据文件类型决定跳转链接
      const fileLower = post.file.toLowerCase();
      if (fileLower.endsWith('.pdf')) {
        link.href = `pdf-viewer.html?file=${encodeURIComponent(post.file)}`;
      } else {
        // 默认为 Markdown
        link.href = `markdown-viewer.html?file=${encodeURIComponent(post.file)}`;
      }
      link.textContent = post.title;
      
      const meta = document.createElement('div');
      meta.className = 'post-meta';
      meta.textContent = `${post.date} · ${post.categoryName}`;
      
      const excerpt = document.createElement('p');
      excerpt.className = 'post-excerpt';
      excerpt.textContent = post.excerpt;
      
      article.appendChild(link);
      article.appendChild(meta);
      article.appendChild(excerpt);
      container.appendChild(article);
    });
  }
</script>
</body>
</html>
